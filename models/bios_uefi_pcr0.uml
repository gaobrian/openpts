<?xml version="1.0" encoding="UTF-8"?>
<uml:Model xmi:version="2.1" xmlns:xmi="http://schema.omg.org/spec/XMI/2.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:uml="http://www.eclipse.org/uml2/3.0.0/UML" xmi:id="3afc1f7e-aecc-11e0-9a5c-0736fe77bf60">
  <packagedElement xmi:type="uml:StateMachine" xmi:id="KjupaeY0" name="">
    <region xmi:id="_OyxVAByrEd6jytZ7WXwL3w" name="bios">

<!-- UEFI BIOS -->
<!-- IBM System X 3500M3, 8 -> 8000008+ -> 4 -->
<!-- Lenovo Thinkpad X1, 8 -> 7 -> 1+ -> 7+ -> 80000009 -> 4 -->

      <subvertex xmi:type="uml:Pseudostate" xmi:id="Start" name="Start"/>
      <subvertex xmi:type="uml:State" xmi:id="CRTM_START" name="CRTM_START" visibility="public">
        <doActivity xmi:type="uml:Activity" xmi:id="_OzCawRyrEd6jytZ7WXwL3w" name="resetPCR(0)"/>
      </subvertex>
      <subvertex xmi:type="uml:State" xmi:id="EV_S_CRTM_VERSION" name="EV_S_CRTM_VERSION" visibility="public"/>

<!-- For Lenovo UEFI, 7 -> 1+ -> 7+ -->
      <subvertex xmi:type="uml:State" xmi:id="EV_S_CRTM_CONTENTS_LENOVO1" name="EV_S_CRTM_CONTENTS_LENOVO1" visibility="public"/>
      <subvertex xmi:type="uml:State" xmi:id="EV_POST_CODE_LENOVO" name="EV_POST_CODE_LENOVO" visibility="public"/>
      <subvertex xmi:type="uml:State" xmi:id="EV_S_CRTM_CONTENTS_LENOVO2" name="EV_S_CRTM_CONTENTS_LENOVO2" visibility="public"/>


<!-- IBM System X 3500M3, 8000008+  -->
      <subvertex xmi:type="uml:State" xmi:id="EV_EFI_PLATFORM_FIRMWARE_BLOB" name="EV_EFI_PLATFORM_FIRMWARE_BLOB"/>
      <subvertex xmi:type="uml:State" xmi:id="EV_EFI_HANDOFF_TABLES" name="EV_EFI_HANDOFF_TABLES" visibility="public"/>


<!-- final -->
      <subvertex xmi:type="uml:State" xmi:id="EV_SEPARATOR" name="EV_SEPARATOR" visibility="public">
        <doActivity xmi:type="uml:Activity" xmi:id="_OzCawZyrEd6jytZ7WXwL3w" name="flashFSM()"/>
      </subvertex>
      <subvertex xmi:type="uml:State" xmi:id="BIOS_PCR0_Verified" name="BIOS_PCR0_Verified" visibility="public">
        <doActivity xmi:type="uml:Activity" xmi:id="_OzCawByrEd6jytZ7WXwL3w" name="setAssertion(bios.pcr.0.integrity, valid)"/>
      </subvertex>
      <subvertex xmi:type="uml:FinalState" xmi:id="Final"/>



<!-- Start -->
      <transition xmi:id="Kk02jZs0" name="CRTM_START_trans" visibility="public" kind="local" 
        source="Start" 
        target="CRTM_START"/>

      <transition name="EV_S_CRTM_VERSION_trans" visibility="public" kind="local" 
        source="CRTM_START" 
        target="EV_S_CRTM_VERSION" 
        xmi:id="CRTM_START_to_EV_S_CRTM_VERSION" 
        guard="CRTM_START_to_EV_S_CRTM_VERSION_guard">
        <ownedRule xmi:id="CRTM_START_to_EV_S_CRTM_VERSION_guard" name="">
          <specification xmi:type="uml:OpaqueExpression" 
            xmi:id="CRTM_START_to_EV_S_CRTM_VERSION_spec" name="">
            <body>eventtype == 0x08, digest == base64</body>
          </specification>
        </ownedRule>
      </transition>




<!-- For IBM System X -->

      <transition visibility="public" kind="local"
        source="EV_S_CRTM_VERSION"
        target="EV_EFI_PLATFORM_FIRMWARE_BLOB"
        xmi:id="VERSION_to_IBM"
        guard="VERSION_to_IBM_guard">
        <name xsi:nil="true"/>
        <ownedRule xmi:id="VERSION_to_IBM_guard" name="">
          <specification xmi:type="uml:OpaqueExpression"
            xmi:id="VERSION_to_IBM_spec" name="">
            <body>eventtype == 0x80000008, digest == base64</body>
          </specification>
        </ownedRule>
      </transition>

      <transition xmi:id="EV_EFI_PLATFORM_FIRMWARE_BLOB_loop" visibility="public" kind="local"
        source="EV_EFI_PLATFORM_FIRMWARE_BLOB"
        target="EV_EFI_PLATFORM_FIRMWARE_BLOB"
        guard="EV_EFI_PLATFORM_FIRMWARE_BLOB_guard">
        <name xsi:nil="true"/>
        <ownedRule xmi:id="EV_EFI_PLATFORM_FIRMWARE_BLOB_guard" name="">
          <specification xmi:type="uml:OpaqueExpression" xmi:id="EV_EFI_PLATFORM_FIRMWARE_BLOB_spec" name="">
            <body>eventtype == 0x80000008, digest == base64</body>
          </specification>
        </ownedRule>
      </transition>


      <transition visibility="public" kind="local" 
        source="EV_EFI_PLATFORM_FIRMWARE_BLOB" 
        target="EV_SEPARATOR" 
        xmi:id="EV_EFI_PLATFORM_FIRMWARE_BLOB_to_EV_SEPARATOR" 
        guard="EV_EFI_PLATFORM_FIRMWARE_BLOB_to_EV_SEPARATOR_guard">
        <name xsi:nil="true"/>
        <ownedRule xmi:id="EV_EFI_PLATFORM_FIRMWARE_BLOB_to_EV_SEPARATOR_guard">
          <specification xmi:type="uml:OpaqueExpression" 
            xmi:id="EV_EFI_PLATFORM_FIRMWARE_BLOB_to_EV_SEPARATOR_spec">
            <body>eventtype == 0x04</body>
          </specification>
        </ownedRule>
      </transition>

<!-- For Lenovo UEFI -->

      <transition visibility="public" kind="local"
        source="EV_S_CRTM_VERSION" 
        target="EV_S_CRTM_CONTENTS_LENOVO1" 
        xmi:id="EV_S_CRTM_VERSION_EV_S_CRTM_CONTENTS_trans" 
        guard="EV_S_CRTM_VERSION_EV_S_CRTM_CONTENTS_guard">
        <ownedRule xmi:id="EV_S_CRTM_VERSION_EV_S_CRTM_CONTENTS_guard" name="">
          <specification xmi:type="uml:OpaqueExpression" xmi:id="EV_S_CRTM_VERSION_EV_S_CRTM_CONTENTS_spec" name="">
            <body>eventtype == 0x07, digest == base64</body>
          </specification>
        </ownedRule>
      </transition>

      <transition visibility="public" kind="local" 
        source="EV_S_CRTM_CONTENTS_LENOVO1" 
        target="EV_POST_CODE_LENOVO" 
        name="EV_S_CRTM_CONTENTS_to_EV_POST_CODE_LENOVO_UEFI"
        xmi:id="EV_S_CRTM_CONTENTS_to_EV_POST_CODE_LENOVO_UEFI"
        guard="EV_S_CRTM_CONTENTS_to_EV_POST_CODE_guard">
        <ownedRule xmi:id="EV_S_CRTM_CONTENTS_to_EV_POST_CODE_LENOVO_UEFI_guard" name="">
          <specification xmi:type="uml:OpaqueExpression" 
            xmi:id="EV_S_CRTM_CONTENTS_to_EV_POST_CODE_LENOVO_UEFI_spec" name="">
            <body>eventtype == 0x01, digest == base64</body>
          </specification>
        </ownedRule>
      </transition>

      <transition visibility="public" kind="local" 
        source="EV_POST_CODE_LENOVO" 
        target="EV_POST_CODE_LENOVO" 
        name="EV_POST_CODE_LENOVO_UEFI_loop"
        xmi:id="EV_POST_CODE_LENOVO_UEFI_loop"
        guard="EV_POST_CODE_LENOVO_UEFI_loop_guard">
        <ownedRule xmi:id="EV_POST_CODE_LENOVO_UEFI_loop_guard" name="">
          <specification xmi:type="uml:OpaqueExpression" 
            xmi:id="EV_POST_CODE_LENOVO_UEFI_loop_spec" name="">
            <body>eventtype == 0x01, digest == base64</body>
          </specification>
        </ownedRule>
      </transition>


      <transition visibility="public" kind="local" 
        source="EV_POST_CODE_LENOVO" 
        target="EV_S_CRTM_CONTENTS_LENOVO2" 
        name="EV_POST_CODE_LENOVO_UEFI_to_EV_S_CRTM_CONTENTS_UEFI"
        xmi:id="EV_POST_CODE_LENOVO_UEFI_to_EV_S_CRTM_CONTENTS_UEFI"
        guard="EV_POST_CODE_LENOVO_UEFI_to_EV_S_CRTM_CONTENTS_UEFI_guard">
        <ownedRule xmi:id="EV_POST_CODE_LENOVO_UEFI_to_EV_S_CRTM_CONTENTS_UEFI_guard" name="">
          <specification xmi:type="uml:OpaqueExpression" 
            xmi:id="EV_POST_CODE_LENOVO_UEFI_to_EV_S_CRTM_CONTENTS_UEFI_spec" name="">
            <body>eventtype == 0x07, digest == base64</body>
          </specification>
        </ownedRule>
      </transition>


      <transition visibility="public" kind="local" 
        source="EV_S_CRTM_CONTENTS_LENOVO2" 
        target="EV_S_CRTM_CONTENTS_LENOVO2" 
        name="EV_S_CRTM_CONTENTS_UEFI_loop"
        xmi:id="EV_S_CRTM_CONTENTS_UEFI_loop"
        guard="EV_S_CRTM_CONTENTS_UEFI_loop_guard">
        <ownedRule xmi:id="EV_S_CRTM_CONTENTS_UEFI_loop_guard" name="">
          <specification xmi:type="uml:OpaqueExpression" 
            xmi:id="EV_S_CRTM_CONTENTS_UEFI_loop_spec" name="">
            <body>eventtype == 0x07, digest == base64</body>
          </specification>
        </ownedRule>
      </transition>

      <transition visibility="public" kind="local" 
        source="EV_S_CRTM_CONTENTS_LENOVO2" 
        target="EV_EFI_HANDOFF_TABLES" 
        name="EV_S_CRTM_CONTENTS_UEFI_to_EV_EFI_HANDOFF_TABLES"
        xmi:id="EV_S_CRTM_CONTENTS_UEFI_to_EV_EFI_HANDOFF_TABLESp"
        guard="EV_S_CRTM_CONTENTS_UEFI_to_EV_EFI_HANDOFF_TABLES_guard">
        <ownedRule xmi:id="EV_S_CRTM_CONTENTS_UEFI_to_EV_EFI_HANDOFF_TABLES_guard" name="">
          <specification xmi:type="uml:OpaqueExpression" 
            xmi:id="EV_S_CRTM_CONTENTS_UEFI_to_EV_EFI_HANDOFF_TABLES_spec" name="">
            <body>eventtype == 0x80000009</body>
          </specification>
        </ownedRule>
      </transition>

      <transition visibility="public" kind="local" 
        source="EV_EFI_HANDOFF_TABLES" 
        target="EV_SEPARATOR" 
        xmi:id="EV_EFI_HANDOFF_TABLES_to_EV_SEPARATOR" 
        guard="EV_EFI_HANDOFF_TABLES_to_EV_SEPARATOR_guard">
        <name xsi:nil="true"/>
        <ownedRule xmi:id="EV_EFI_HANDOFF_TABLES_to_EV_SEPARATOR_guard" name="">
          <specification xmi:type="uml:OpaqueExpression"    
            xmi:id="EV_EFI_HANDOFF_TABLES_to_EV_SEPARATOR_spec" name="">
            <body>eventtype == 0x04</body>
          </specification>
        </ownedRule>
      </transition>


<!-- Final -->
      <transition xmi:id="KxUWni90" visibility="public" kind="local"
        source="EV_SEPARATOR"
        target="BIOS_PCR0_Verified">
        <name xsi:nil="true"/>
      </transition>

      <transition xmi:id="KoByXxb0" visibility="public" kind="local" 
        source="BIOS_PCR0_Verified" 
        target="Final">
        <name xsi:nil="true"/>
      </transition>

    </region>
  </packagedElement>
</uml:Model>
